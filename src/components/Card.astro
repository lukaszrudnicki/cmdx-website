---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  href?: string;
  title: string;
  image?: ImageMetadata | string;
  imageAlt?: string;
  class?: string;
}

const {
  href,
  title,
  image,
  imageAlt,
  class: className = ''
} = Astro.props;

const cardClasses = `
  group relative rounded-2xl overflow-hidden
  shadow-lg hover:shadow-2xl transition-all duration-500
  hover:-translate-y-2 ${className}
`;

// Check if image is a local import (ImageMetadata) or external URL (string)
const isLocalImage = image && typeof image === 'object';
const isExternalImage = image && typeof image === 'string';
---

<article class={cardClasses}>
  {href ? (
    <a href={href} class="block relative">
      {image ? (
        <div class="relative overflow-hidden aspect-square bg-gray-200 dark:bg-gray-800">
          {isLocalImage ? (
            <Image
              src={image}
              alt={imageAlt || title}
              width={800}
              height={800}
              quality={85}
              format="webp"
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              loading="lazy"
            />
          ) : (
            <img
              src={image as string}
              alt={imageAlt || title}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              loading="lazy"
            />
          )}
          {/* Gradient overlay - subtle, only at bottom */}
          <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>

          {/* Title on image */}
          <div class="absolute bottom-0 left-0 right-0 p-6">
            <h3 class="text-2xl font-bold text-white group-hover:text-purple-300 transition-colors duration-300">
              {title}
            </h3>
          </div>
        </div>
      ) : (
        <div class="relative overflow-hidden aspect-square bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/20 dark:to-pink-900/20">
          <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
          <div class="absolute bottom-0 left-0 right-0 p-6">
            <h3 class="text-2xl font-bold text-white group-hover:text-purple-300 transition-colors duration-300">
              {title}
            </h3>
          </div>
        </div>
      )}
    </a>
  ) : (
    <div class="relative">
      {image ? (
        <div class="relative overflow-hidden aspect-square bg-gray-200 dark:bg-gray-800">
          {isLocalImage ? (
            <Image
              src={image}
              alt={imageAlt || title}
              width={800}
              height={800}
              quality={85}
              format="webp"
              class="w-full h-full object-cover brightness-75"
              loading="lazy"
            />
          ) : (
            <img
              src={image as string}
              alt={imageAlt || title}
              class="w-full h-full object-cover brightness-75"
              loading="lazy"
            />
          )}
          <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
          <div class="absolute bottom-0 left-0 right-0 p-6">
            <h3 class="text-2xl font-bold text-white">
              {title}
            </h3>
          </div>
        </div>
      ) : (
        <div class="relative overflow-hidden aspect-square bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/20 dark:to-pink-900/20">
          <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
          <div class="absolute bottom-0 left-0 right-0 p-6">
            <h3 class="text-2xl font-bold text-white">
              {title}
            </h3>
          </div>
        </div>
      )}
    </div>
  )}
</article>
