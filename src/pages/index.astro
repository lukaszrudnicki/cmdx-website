---
import { getCollection } from 'astro:content';
import SEOLayout from '../layouts/SEOLayout.astro';
import Nav from '../components/Nav.astro';
import Hero from '../components/Hero.astro';
import Button from '../components/Button.astro';
import Card from '../components/Card.astro';
import Section from '../components/Section.astro';
import Footer from '../components/Footer.astro';
import Contact from '../components/Contact.astro';

// Pobierz najnowsze wpisy
const blogPosts = await getCollection('blog', ({ data }) => data.draft !== true);
const portfolioItems = await getCollection('portfolio');

const latestBlog = blogPosts.sort((a, b) =>
  b.data.publishDate.getTime() - a.data.publishDate.getTime()
).slice(0, 3);

const featuredPortfolio = portfolioItems
  .filter(item => item.data.featured)
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 3);

// Schema.org dla strony głównej
const siteUrl = Astro.site?.toString() || 'https://cmdx.pl';
const homeSchema = {
  "@context": "https://schema.org",
  "@graph": [
    // 1. Organization - główna firma
    {
      "@type": "Organization",
      "@id": `${siteUrl}#organization`,
      "name": "CMDX",
      "alternateName": "CMDX Design Studio",
      "url": siteUrl,
      "logo": {
        "@type": "ImageObject",
        "url": `${siteUrl}/logo.png`,
        "width": 250,
        "height": 60
      },
      "image": `${siteUrl}/og-default.jpg`,
      "description": "Studio projektowe specjalizujące się w brandingu, identyfikacji wizualnej i web developmencie. Grafik na abonament dla Twojego biznesu.",
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "PL",
        "addressLocality": "Warszawa"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "email": "kontakt@cmdx.pl",
        "availableLanguage": ["Polish", "English"]
      },
      "sameAs": [
        "https://instagram.com/cmdx.design",
        "https://behance.net/cmdx",
        "https://dribbble.com/cmdx"
      ]
    },
    // 2. WebSite - strona główna
    {
      "@type": "WebSite",
      "@id": `${siteUrl}#website`,
      "url": siteUrl,
      "name": "CMDX - Grafik na abonament",
      "description": "Wzmocnij swój zespół projektantem, tak jak by był u Ciebie w biurze za ułamek kwoty jaką byś zapłacił za jego etat!",
      "publisher": {
        "@id": `${siteUrl}#organization`
      },
      "inLanguage": "pl-PL"
    },
    // 3. ProfessionalService - usługi designerskie
    {
      "@type": "ProfessionalService",
      "@id": `${siteUrl}#service`,
      "name": "CMDX - Usługi Graficzne i Designerskie",
      "description": "Profesjonalne usługi graficzne na abonament: branding, identyfikacja wizualna, design graficzny, web development",
      "provider": {
        "@id": `${siteUrl}#organization`
      },
      "serviceType": "Graphic Design & Branding Services",
      "areaServed": {
        "@type": "Country",
        "name": "Poland"
      },
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Design Services",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Branding & Identyfikacja Wizualna",
              "description": "Tworzenie spójnej identyfikacji wizualnej marki"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Grafika dla Gastronomii",
              "description": "Specjalistyczne usługi graficzne dla branży gastronomicznej"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Web Design & Development",
              "description": "Projektowanie i rozwój stron internetowych"
            }
          }
        ]
      }
    },
    // 4. WebPage - strona główna
    {
      "@type": "WebPage",
      "@id": siteUrl,
      "url": siteUrl,
      "name": "CMDX - Grafik na abonament",
      "description": "Wzmocnij swój zespół projektantem, tak jak by był u Ciebie w biurze za ułamek kwoty jaką byś zapłacił za jego etat!",
      "isPartOf": {
        "@id": `${siteUrl}#website`
      },
      "about": {
        "@id": `${siteUrl}#organization`
      },
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": `${siteUrl}/og-default.jpg`,
        "width": 1200,
        "height": 630
      },
      "inLanguage": "pl-PL"
    }
  ]
};
---

<SEOLayout
  title="CMDX - Grafik na abonament"
  description="Wzmocnij swój zespół projektantem, tak jak by był u Ciebie w biurze za ułamek kwoty jaką byś zapłacił za jego etat!"
  keywords={['portfolio', 'grafika', 'design', 'blog', 'projekty', 'branding', 'identyfikacja wizualna', 'grafik na abonament']}
  disableBaseSchema={true}
>
  <!-- Enhanced Schema.org for Homepage -->
  <script type="application/ld+json" slot="schema" set:html={JSON.stringify(homeSchema)} />

  <Nav />

  <Hero />

  <!-- Featured Projects -->
  {featuredPortfolio.length > 0 && (
    <Section
      title="Wyróżnione Projekty"
      subtitle="Moje najlepsze realizacje dla klientów"
      background="white"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {featuredPortfolio.map((item) => (
          <Card
            href={`/portfolio/${item.slug}`}
            title={item.data.title}
            image={item.data.coverImage}
            imageAlt={item.data.coverImageAlt || item.data.title}
          />
        ))}
      </div>
      <div class="text-center mt-12">
        <Button href="/portfolio" variant="primary">
          Zobacz Wszystkie Projekty →
        </Button>
      </div>
    </Section>
  )}


  

  <!-- Latest Blog Posts -->
  {latestBlog.length > 0 && (
    <Section
      title="Najnowsze z Bloga"
      subtitle="Artykuły, poradniki i inspiracje ze świata designu"
      background="white"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {latestBlog.map((post) => (
          <Card
            href={`/blog/${post.slug}`}
            title={post.data.title}
            image="https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=600&fit=crop"
            imageAlt={post.data.title}
          />
        ))}
      </div>
      <div class="text-center mt-12">
        <Button href="/blog" variant="secondary">
          Więcej Artykułów →
        </Button>
      </div>
    </Section>
  )}

  <Contact />

  <Footer />
</SEOLayout>
