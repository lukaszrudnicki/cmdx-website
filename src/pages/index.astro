---
import { getCollection } from 'astro:content';
import SEOLayout from '../layouts/SEOLayout.astro';
import Nav from '../components/Nav.astro';
import Hero from '../components/Hero.astro';
import Button from '../components/Button.astro';
import Card from '../components/Card.astro';
import Section from '../components/Section.astro';
import Footer from '../components/Footer.astro';
import Contact from '../components/Contact.astro';

// Pobierz najnowsze wpisy
const blogPosts = await getCollection('blog', ({ data }) => data.draft !== true);
const portfolioItems = await getCollection('portfolio');

const latestBlog = blogPosts.sort((a, b) =>
  b.data.publishDate.getTime() - a.data.publishDate.getTime()
).slice(0, 3);

const featuredPortfolio = portfolioItems
  .filter(item => item.data.featured)
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 3);
---

<SEOLayout
  title="CMDX - Grafik na abonament"
  description="Wzmocnij swój zespół projektantem, tak jak by był u Ciebie w biurze za ułamek kwoty jaką byś zapłacił za jego etat!"
  keywords={['portfolio', 'grafika', 'design', 'blog', 'projekty']}
>
  <Nav />

  <Hero />

  <!-- Featured Projects -->
  {featuredPortfolio.length > 0 && (
    <Section
      title="Wyróżnione Projekty"
      subtitle="Moje najlepsze realizacje dla klientów"
      background="white"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {featuredPortfolio.map((item) => (
          <Card
            href={`/portfolio/${item.slug}`}
            title={item.data.title}
            image={item.data.coverImage}
            imageAlt={item.data.coverImageAlt || item.data.title}
          />
        ))}
      </div>
      <div class="text-center mt-12">
        <Button href="/portfolio" variant="primary">
          Zobacz Wszystkie Projekty →
        </Button>
      </div>
    </Section>
  )}


  

  <!-- Latest Blog Posts -->
  {latestBlog.length > 0 && (
    <Section
      title="Najnowsze z Bloga"
      subtitle="Artykuły, poradniki i inspiracje ze świata designu"
      background="white"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {latestBlog.map((post) => (
          <Card
            href={`/blog/${post.slug}`}
            title={post.data.title}
            image="https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=600&fit=crop"
            imageAlt={post.data.title}
          />
        ))}
      </div>
      <div class="text-center mt-12">
        <Button href="/blog" variant="secondary">
          Więcej Artykułów →
        </Button>
      </div>
    </Section>
  )}

  <Contact />

  <Footer />
</SEOLayout>
